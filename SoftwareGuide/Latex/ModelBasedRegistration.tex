%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%
%   This file is included in Registration.tex
%
%   Lablels and section entries are defined in that file.
%
%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{figure}
\center
\includegraphics[width=12cm]{ModelToImageRegistrationComponentsDiagram.eps}
\itkcaption[Model to Image Registration Framework Components]{The basic components
  of model based registration are an image, a spatial object, a transform, a
    metric, an interpolator and an optimizer.}
\label{fig:ModelToImageRegistrationComponentsDiagram}
\end{figure}


This section introduces the concept of registering a geometrical model with an
image. We refer to this concept as \emph{Model Based Registration} but this may
not be the most widespread terminology. In this approach for registration, a
geometrical model is build first and a number of parameters are identified in
the model. Variations of these parameters make possible to adapt the model to
the particular morphology of a specific patient. The task of registration is
then to find the optimal combinations of the model parameters that will make
this model fit as a good representation of the anatomical structure contained
in an image. 


\begin{figure}
\center
\includegraphics[width=12cm]{ModelToImageRegistrationConcept.eps}
\itkcaption[Model to Image Registration Framework Concept]{Basic concept of
  Model-to-Image registration.  A simplified geometrical model (ellipse) is
    registered against an anatomical structure (skull)  by applying a spatial
    transform and modifying the model internal parameters. This image is not
    the result of an actual registration, it is shown here only with the
    purpose of illustrating the concept of model to image registration.}
\label{fig:ModelToImageRegistrationConcept}
\end{figure}


For example, let's say that in the axial view of a brain image we can roughly
approximate the skull with an ellipse. The ellipse becomes our simplified
geometrical model, and registration is the task of finding the best center for
the ellipse, the measures of its axis lengths and its orientation on the plane.
This is illustrated in Figure~\ref{fig:ModelToImageRegistrationConcept}.  If we
compare this aproach with the Image-to-Image registration problem, we can see
that the main difference here is that in addition to mapping the spatial
position of the model, we can also customize internal parameters that change
its shape.

Figure~\ref{fig:ModelToImageRegistrationComponentsDiagram} illustrates the
major components of the registration framework in ITK when a model base
registration problem is configured. The basic input data for the registration
is provided by pixel data in an \doxygen{Image} and by geometrical data stored
in a \doxygen{SpatialObject}. A Metric has to be defined in order to evaluate
the fitness between the model and the image. This fitness value can be improved
by introducing variations in the spatial positioning of the
\doxygen{SpatialObject} and/or by changing its internal parameters. The search
space for the optimizer is now the composition of the transform parameter and
the shape internal parameters.

This same approach can be considered a segmentation technique, since once the
model has been optimally superimposed to the image we could label pixels
according to their associations with specific parts of the model. The
perpectives of model to image registration/segmentation are endless.  Probably
the main advantage of this approach is that, as opposed to image-to-image
registration, it actually provides \emph{Insight} into the anatomical structure
contained in the image. The adapted model becomes a condensed representation of
the essential elements of the anatomical structure.

ITK provides a hierarchy of classes intended to support the construction of
shape models. This hierarchy has the \doxygen{SpatialObject} as its base class.
A number of basic functionalities are defined at this level. For example, the
capacity to evaluate is a given point is \emph{inside} or \emph{outside} of the
model, the capability to form complex shapes by creating hierarchical
conglomerates of basic shapes and the support for basic spatial
parameterizations like scale, orientation and position.

The following sections present examples of the typical uses of these powerful
elements of the toolkit.

%\ifitkFullVersion
\input{ModelToImageRegistration1.tex} 
%\fi




